{% extends "templates.html" %}

{% block header %}
<title>Dashboard</title>
{% endblock %}

{% block content %}
<div class="row">
    <div class="x_panel tile">
        <div class="x_title">
            <h2>General</h2>
            <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                <li><a class="close-link"><i class="fa fa-close"></i></a></li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content" style="display:block;">
            <div class="row" id="general_tables"> </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<br/>

<div class="row">
    <div class="x_panel tile">
        <div class="x_title">
            <h2>CPU</h2>
            <ul class="nav navbar-right panel_toolbox">
                <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                <li><a class="close-link"><i class="fa fa-close"></i></a></li>
            </ul>
            <div class="clearfix"></div>
        </div>
        <div class="x_content" style="display:block;">
            <div class="col-md-9 col-sm-9 col-xs-12">
                <div id="placeholder33" style="height: 260px; display: none" class="demo-placeholder"></div>
                <div style="width: 100%;">
                    <div id="canvas_dash" class="demo-placeholder" style="width: 100%; height: 270px; padding: 0px; position: relative;">
                        <canvas class="flot-base" width="844" height="270" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 844px; height: 270px;"></canvas>
                        <canvas class="flot-overlay" width="844" height="270" style="direction: ltr; position: absolute; left: 0px; top: 0px; width: 844px; height: 270px;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-sm-3 col-xs-12 bg-white" id="cpu_tables">
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<br/>


<script src="/static/js/bootstrap.min.js"></script>

<!-- gauge js -->
<!-- <script type="text/javascript" src="/static/js/gauge/gauge.min.js"></script> -->
<!-- <script type="text/javascript" src="/static/js/gauge/gauge_demo.js"></script> -->
<!-- bootstrap progress js -->
<script src="/static/js/progressbar/bootstrap-progressbar.min.js"></script>
<script src="/static/js/nicescroll/jquery.nicescroll.min.js"></script>
<!-- icheck -->
<script src="/static/js/icheck/icheck.min.js"></script>
<!-- daterangepicker -->
<script type="text/javascript" src="/static/js/moment/moment.min.js"></script>
<script type="text/javascript" src="/static/js/datepicker/daterangepicker.js"></script>
<!-- chart js -->
<script src="/static/js/chartjs/chart.min.js"></script>

<script src="/static/js/custom.js"></script>

<!-- flot js -->
<!--[if lte IE 8]><script type="text/javascript" src="js/excanvas.min.js"></script><![endif]-->
<script type="text/javascript" src="/static/js/flot/jquery.flot.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.pie.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.orderBars.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.time.min.js"></script>
<script type="text/javascript" src="/static/js/flot/date.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.spline.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.stack.js"></script>
<script type="text/javascript" src="/static/js/flot/curvedLines.js"></script>
<script type="text/javascript" src="/static/js/flot/jquery.flot.resize.js"></script>
<script>
    plt_datas = [];
plt_colors = [];
plt_font_colors = [];
plt_nums = 0;
function draw() {
    $("#canvas_dash").length && $.plot($("#canvas_dash"), plt_datas, {
        series: {
            lines: {
                show: false,
                fill: true
            },
            splines: {
                show: true,
                tension: 0.4,
                lineWidth: 1,
                fill: 0.4
            },
            points: {
                radius: 0,
                show: true
            },
            shadowSize: 2
        },
        grid: {
            verticalLines: true,
            hoverable: true,
            clickable: true,
            tickColor: "#d5d5d5",
            borderWidth: 1,
            color: '#fff'
        },
        colors: plt_colors,
        xaxis: {
            tickColor: "rgba(51, 51, 51, 0.06)",
            mode: "time",
            tickSize: [5, "second"],
            axisLabel: "Seconds",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 100,
            ticks: 8,
            tickColor: "rgba(51, 51, 51, 0.06)",
        },
        tooltip: false
    });
}
</script>
<script>
    function random_color() {
        var r = Math.floor(Math.random()*256);
        var g = Math.floor(Math.random()*256);
        var b = Math.floor(Math.random()*256);
        plt_colors.push('rgba('+ r +','+ g +','+ b +',0.38)');
        plt_font_colors.push('rgb('+r+','+g+','+b+')');
    }
function get_color(x) {
    if (x > 70)
        return "red";
    if (x > 30)
        return "orange";
    return "green";
}

function add_unite(data) {
    general_tables
}
function ps() {
    $.ajax({
        url: '/ps',
        type: 'get',
        dataType: 'json',
        success: function(res) {
            var cpu_tables = '';
            var general_tables = [];
            var s = Math.round((res.time+8*3600) * 1000);
            var n = res.data.cpu.length;
            pack = res
            while (plt_nums < n) {
                plt_nums += 1;
                random_color();
                plt_datas.push([]);
            }
            for (var cpu in res.data.cpu) {
                var usg = res.data.cpu[cpu];
                plt_datas[cpu].push([s, Math.round(usg)]);
                if (plt_datas[cpu].length > 10) {
                    plt_datas[cpu].shift();
                }
                var color = get_color(usg);
                cpu_tables += `
                    <div class="">
                    <div class="row">
                            <div class="col-md-9 col-sm-9 col-xs-12">
                                <span style="color:${plt_colors[cpu]};">
                                    CPU${cpu}:
                                </span>
                                ${usg}%
                            </div>
                        </div>
                        <div class="progress progress_sm" style="width: 100%;">
                            <div class="progress-bar bg-${color}" role="progressbar" data-transitiongoal="80" aria-valuenow="79" style="width: ${usg}%;"></div>
                        </div>
                    </div>
                `;
                general_tables.push(`
                    <div class="">
                        <div class="row">
                            <div class="col-md-9 col-sm-9 col-xs-12">
                                CPU ${cpu}: <span style="color:${color}">${usg}%</span>
                            </div>
                        </div>
                        <div class="progress progress_sm" style="width: 100%;">
                            <div class="progress-bar bg-${color}" role="progressbar" data-transitiongoal="80" aria-valuenow="79" style="width: ${usg}%;"></div>
                        </div>
                    </div>
                `);
            }
            var color = get_color(res.data.memory.percent);
            general_tables.push(`
                <div class="">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            Memory: <span style="color:${color}">${res.data.memory.percent}%</span>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <span style="color:${color}">${res.data.memory.used}/${res.data.memory.total}</span>
                            
                        </div>
                    </div>
                    <div class="progress progress_sm" style="width: 100%;">
                        <div class="progress-bar bg-${color}" role="progressbar" data-transitiongoal="80" aria-valuenow="79" style="width: ${res.data.memory.percent}%;"></div>
                    </div>
                </div>
            `);
            var color = get_color(res.data.swap.percent);
            general_tables.push(`
                <div class="">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            Swap: <span style="color:${color}">${res.data.swap.percent}%</span>
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            <span style="color:${color}">${res.data.swap.used}/${res.data.swap.total}</span>
                            
                        </div>
                    </div>
                    <div class="progress progress_sm" style="width: 100%;">
                        <div class="progress-bar bg-${color}" role="progressbar" data-transitiongoal="80" aria-valuenow="79" style="width: ${res.data.swap.percent}%;"></div>
                    </div>
                </div>
            `);
            
            var split_num = 4;
            var num = Math.ceil(general_tables.length / split_num);
            var general_html = '';
            for (var i = 0; i < split_num; i += 1) {
                general_html += `<div class="col-md-3 col-sm-4 col-xs-12 bg-white" id="general_tables">`;
                for (var j = i * num; j < Math.min(i * num + num, general_tables.length); j += 1)
                    general_html += general_tables[j];
                general_html += `</div>`;
            }


            $("#cpu_tables").html(cpu_tables);
            $("#general_tables").html(general_html);
            draw();
        },
        error: function() {

        }
    });
}
ps();
setInterval("ps()", 5000);
</script>
{% endblock %}
